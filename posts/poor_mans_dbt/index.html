<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=false><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Building a poor man's dbt with Make &#183; robbmann</title><meta name=title content="Building a poor man's dbt with Make &#183; robbmann"><meta name=description content="It's Robb, man!"><link rel=canonical href=https://robbmann.io/posts/poor_mans_dbt/><link type=text/css rel=stylesheet href=/css/main.bundle.min.564bd42a5e26b676657968da510e1b5dc2e901c82ae40e09a52f34b39ed1bf23f65778b05cb2d87a4affbbc5296a3cfd0d2f6131469ff95409422e12b6bccfb4.css integrity="sha512-VkvUKl4mtnZleWjaUQ4bXcLpAcgq5A4JpS80s57RvyP2V3iwXLLYekr/u8Upajz9DS9hMUaf+VQJQi4StrzPtA=="><script type=text/javascript src=/js/appearance.min.1dc37605fc23844fe9adb9081ca82717d710e68c83b51e4f7b66549306a870fb615f1a99aab3ccce0599b6cdbc29bba751d8225fb67893310310a31013e05827.js integrity="sha512-HcN2BfwjhE/prbkIHKgnF9cQ5oyDtR5Pe2ZUkwaocPthXxqZqrPMzgWZts28KbunUdgiX7Z4kzEDEKMQE+BYJw=="></script>
<script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.82b89a5d74acc75014660b84f922a73e49266b035892490b64ad19f96959b55dfa06eee8b676651a7eba722ac6c5c05f78285026f71403b929d74c250f3e323e.js integrity="sha512-griaXXSsx1AUZguE+SKnPkkmawNYkkkLZK0Z+WlZtV36Bu7otnZlGn66cirGxcBfeChQJvcUA7kp10wlDz4yPg==" data-copy=Copy data-copied=Copied></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Building a poor man's dbt with Make"><meta property="og:description" content="In data science and engineering we tend to think in &ldquo;DAGs&rdquo; (directed acyclic graphs), which just means &ldquo;to make this report, we first have to build this other thing, and to build that thing, we have to run these two queries, and so on."><meta property="og:type" content="article"><meta property="og:url" content="https://robbmann.io/posts/poor_mans_dbt/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-06T14:22:30-05:00"><meta property="article:modified_time" content="2022-03-06T14:22:30-05:00"><meta property="og:site_name" content="robbmann"><meta name=twitter:card content="summary"><meta name=twitter:title content="Building a poor man's dbt with Make"><meta name=twitter:description content="In data science and engineering we tend to think in &ldquo;DAGs&rdquo; (directed acyclic graphs), which just means &ldquo;to make this report, we first have to build this other thing, and to build that thing, we have to run these two queries, and so on."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Building a poor man\u0027s dbt with Make","headline":"Building a poor man\u0027s dbt with Make","abstract":"In data science and engineering we tend to think in \u0026ldquo;DAGs\u0026rdquo; (directed acyclic graphs), which just means \u0026ldquo;to make this report, we first have to build this other thing, and to build that thing, we have to run these two queries, and so on.","inLanguage":"en","url":"https:\/\/robbmann.io\/posts\/poor_mans_dbt\/","author":{"@type":"Person","name":"Robert Enzmann"},"copyrightYear":"2022","dateCreated":"2022-03-06T14:22:30-05:00","datePublished":"2022-03-06T14:22:30-05:00","dateModified":"2022-03-06T14:22:30-05:00","mainEntityOfPage":"true","wordCount":"3472"}]</script><meta name=generator content="Hugo 0.94.2"><meta name=author content="Robert Enzmann"><link href=mailto:robbenzmann@gmail.com rel=me><link href=https://github.com/renzmann rel=me><link href=https://www.linkedin.com/in/renzmann rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral"><div><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>robbmann</a></div><nav><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/resume.pdf title>Resume</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts/ title=Posts>Posts</a></li><li class="ltr:text-right rtl:text-left ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><button id=search-button class="text-base hover:text-primary-600 dark:hover:text-primary-400" title="Search (/)">
<span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button></li></ul></nav></header><main id=main-content class="relative grow"><article><header class=max-w-prose><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Building a poor man's dbt with Make</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-03-06 14:22:30 -0500 -0500">6 March 2022</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">17 mins</span></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="min-w-0 min-h-0 max-w-prose"><p>In data science and engineering we tend to think in &ldquo;DAGs&rdquo; (directed acyclic
graphs), which just means &ldquo;to make this report, we first have to build this
other thing, and to build <em>that</em> thing, we have to run these two queries, and so
on. It decomposes the process of building data and artifacts like
visualizations or data exports into smaller, individual chunks.</p><img src=sample-dag.png alt="A DAG" caption="An example DAG" width=200><p>There are a lot of contenders in the market for selling solutions to this exact
scenario, and each one solves it a little differently. Right now the hot thing
is <a href=https://docs.getdbt.com/tutorial/setting-up>dbt</a>, but before that we had
airflow, dagster, prefect, argo, and a host of others that all were built to
operate DAGs at scale on different platforms. For large, mission-critical data
pipelines these can provide a lot of value, but the truth is that as data
scientists, most of us don&rsquo;t need something this heavy. Most projects I see
really just need some way of defining the links between &ldquo;scrapbook output&rdquo;.
Maybe it&rsquo;s a jupyter notebook, or a python script, or some queries that have to
happen in a particular order based on an updated warehouse feed.</p><p>Moreover, there are some reasons you might not want to try adding an entire
workflow management ecosystem into your stack. Maybe:</p><ul><li>You can&rsquo;t get permission for a new install</li><li>You don&rsquo;t want to force another install on your end users or coworkers</li><li>You don&rsquo;t want more transitive dependencies entering the picture</li><li>You don&rsquo;t like someone trying to sell their cloud solution on top of the free
tier offering to you</li></ul><p><code>make</code> was born from a history of compiling C programs on Unix machines in the
70&rsquo;s, but it&rsquo;s completely agnostic to language choice. It&rsquo;s job is to translate
<em>targets</em> and <em>prerequisites</em> into a DAG, and incrementally build only the parts
it needs to when any of the source files change. Given that, why would I choose
Make over one of the more modern alternatives?</p><ul><li>The commands are elegant - I enjoy the language of <code>make report.xlsx</code></li><li>Parallel execution is built in and easy to turn on or off</li><li>It&rsquo;s installed on damn near everything,<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> and has proven over the last 50
years to be a shark, not a dinosaur</li><li>It&rsquo;s a &ldquo;small&rdquo; program. You can get through the <a href=https://www.gnu.org/software/make/manual/html_node/Reading.html#Reading>documentation</a>
and start creating useful software in a couple hours.</li><li>Like SQL, Make is declarative. We describe the result, and let the program
optimize the route by which we get there.</li></ul><br><br><h1 id=creating-a-simple-project-with-make-and-python class="relative group">Creating a simple project with <code>make</code> and python <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#creating-a-simple-project-with-make-and-python aria-label=Anchor>#</a></span></h1><p>I&rsquo;m going to use a distilled example of a recent project I built using just a
Makefile, some python, and a little SQL. By the end of this my hope is to show
that simple tools can be efficient and reliable, and avoid the overhead of
learning, installing, configuring, and inevitably debugging something more
complex.<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> Ultimately, I wanted to hand this project off in such a way that
any of my teammates could maintain it if I was unavailable, so it had to be
short, and stick to the tools I know they will always have installed.</p><p>Our goal is to produce an Excel file for executive consumption that has a
meaningful summary of some data pulled out of our analytics warehouse. Overall,
it&rsquo;ll look a little like this:</p><pre tabindex=0><code>base queries --&gt; summary CSVs --&gt; (report.xlsx, diagrams for powerpoint)
</code></pre><p>The &ldquo;base&rdquo; queries might look a lot like temporary tables or common table
expressions (CTEs, or those blocks you see in <code>WITH</code> statements), but we&rsquo;ve
broken them into several, separate queries. We&rsquo;re plopping those summarized
results into some flat files so that we can examine the results with our
favorite tools like <code>pandas</code> or <code>awk</code>. We&rsquo;ll then take all those flat results
and produce deliverables from them, like charts and an excel file.</p><p><code>myguy</code> is always there for me, so that&rsquo;s the name of our project, and its
basic structure looks like this:</p><pre tabindex=0><code>.
├── config.yml
├── Makefile
├── myguy.py
├── README.md
└── sql
    ├── this_quarter_sales.sql
    ├── model_forecast.sql
    └── customer_disposition.sql
</code></pre><p>We will execute each file in the <code>sql/</code> directory as a query we execute and then
locally cache the results as CSVs. Later we&rsquo;ll discuss how to handle the case
where all our queries are handled remotely, and don&rsquo;t create local files, such
as running <code>CREATE TABLE AS</code> (ctas) queries prior to building the report, but
for now we&rsquo;ll keep it simple: query &ndash;> csv on computer.</p><p>Our goal is to make reproducing this report dead simple. I should only have to
run this command to rebuild the report at any time:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>make report.xlsx
</span></span></code></pre></div><p>The cookbook that provides this <em>rule</em> is the <code>Makefile</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=c># Makefile
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nf>report.xlsx</span><span class=o>:</span> <span class=n>myguy</span>.<span class=n>py</span>
</span></span><span class=line><span class=cl>	python -m myguy build-report
</span></span></code></pre></div><p>If this is your first time seeing make, there are a few terms to know:</p><ul><li><code>report.xlsx</code> - this is the <em>target</em> of the rule. It is the file produced by
running <code>make report.xlsx</code></li><li><code>myguy.py</code> - the <em>prerequisite</em> of <code>report.xlsx</code>. It has to exist in order to
create the excel file. If this python file&rsquo;s contents have changed recently,
then that&rsquo;s an indication that <code>report.xlsx</code> may also change.</li><li><code>python -m myguy build-report</code> - this is the <em>recipe</em> that Make runs when you
issue the command <code>make report.xlsx</code>. I am invoking python with the <code>-m</code>, or
&ldquo;run module as main&rdquo; flag in case we ever refactor our single .py file into a
module, like <code>myguy/__init__.py</code> with its complementary &ldquo;dunder main&rdquo;
<code>myguy/__main__.py</code>.</li></ul><p>Our main entry point will be in the python module. This will handle the program
runtime for executing queries or doing some pandas hackery.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python3 data-lang=python3><span class=line><span class=cl><span class=c1># myguy.py</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pathlib</span> <span class=kn>import</span> <span class=n>Path</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>time</span> <span class=kn>import</span> <span class=n>sleep</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>click</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@click</span><span class=o>.</span><span class=n>group</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>cli</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@cli</span><span class=o>.</span><span class=n>command</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nd>@click</span><span class=o>.</span><span class=n>option</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;-o&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;--output&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>help</span><span class=o>=</span><span class=s2>&#34;Write to file&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>default</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>BUILD_DIR</span><span class=si>}</span><span class=s2>/report.xlsx&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>show_default</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_report</span><span class=p>(</span><span class=n>output</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Generate a new Excel workbook and save it locally.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Suppose this produces, you know, useful data</span>
</span></span><span class=line><span class=cl>    <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span><span class=n>a</span><span class=o>=</span><span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>),</span> <span class=n>b</span><span class=o>=</span><span class=nb>list</span><span class=p>(</span><span class=s2>&#34;abc&#34;</span><span class=p>)))</span><span class=o>.</span><span class=n>to_excel</span><span class=p>(</span><span class=n>output</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Saved report to </span><span class=si>{</span><span class=n>output</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>cli</span><span class=p>()</span>
</span></span></code></pre></div><p>I think <code>click</code> is just great, and provides me with a lot of zen writing a
<em>command line interface</em> (CLI) compared to <code>argparse</code>, although you could
achieve everything I&rsquo;m doing in this article equally well with argparse. In
this script we create a cli <code>group</code> because we&rsquo;ll eventually add more commands
to it. The <code>build_report</code> function just replicates a process that takes a
couple seconds before it outputs a file to <code>build/report.xlsx</code>.</p><p>It takes very little code to get a pleasant command line experience with nested
commands. Here&rsquo;s a quick example of using it after adding another command called
<code>query</code>, which we&rsquo;ll get to in a moment:</p><script id=asciicast-FtGlAzi0kBBbJm7JczQFflKWx src=https://asciinema.org/a/FtGlAzi0kBBbJm7JczQFflKWx.js async></script><p>However, if we try building our report right now with <code>make report.xlsx</code>, we get
a <code>FileNotFoundError: [Errno 2] No such file or directory: 'build/report.xlsx'</code>,
and that&rsquo;s because we need to make sure the <code>build</code> directory exists before
running this command. We could handle that in the python with a few lines, but
why not have our dependency management tool, <code>make</code>, do it for us?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=c># Makefile
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nf>build</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	mkdir -p build
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>report.xlsx</span><span class=o>:</span> <span class=n>myguy</span>.<span class=n>py</span> <span class=p>|</span> <span class=n>build</span>
</span></span><span class=line><span class=cl>	python -m myguy build-report
</span></span></code></pre></div><p>Now our <code>make report.xlsx</code> works just fine, and we get a new directory <code>build</code>
with our empty report in it. Normally we won&rsquo;t need the <code>|</code>, but in this case it
declares that the <code>build</code> rule should only be run once, even if we have other
targets with <code>build</code> as a prerequisite.<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> If we rerun <code>make report.xlsx</code>, it
doesn&rsquo;t try to create that directory again, because it already exists.</p><p>We do have one other problem though: if we re-run the python code, it will
overwrite our report, even if nothing has changed. Instead, we should get a
message saying <code>make: 'report.xlsx' is up to date.</code> This is happening because
our target is <code>report.xlsx</code> instead of <code>build/report.xlsx</code>, so <code>make</code> looks in
the current directory, sees that there&rsquo;s no <code>report.xlsx</code> and therefore runs the
recipe. I don&rsquo;t want to write <code>make build/report.xlsx</code>, so what we&rsquo;ll do is set
up <code>make</code> to automatically look in our <code>build</code> and <code>sql</code> directories for files
by setting the <a href=https://www.gnu.org/software/make/manual/html_node/General-Search.html title="GNU Make: General Search"><code>VPATH</code> variable</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=c># Makefile
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nv>BUILDDIR</span> <span class=o>:=</span> build
</span></span><span class=line><span class=cl><span class=nv>SQLDIR</span> <span class=o>:=</span> sql
</span></span><span class=line><span class=cl><span class=nv>VPATH</span> <span class=o>:=</span> <span class=k>$(</span>SQLDIR<span class=k>)</span>:<span class=k>$(</span>TARGETDIR<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>$(BUILDDIR)</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	mkdir -p <span class=k>$(</span>BUILDDIR<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>report.xlsx</span><span class=o>:</span> <span class=n>myguy</span>.<span class=n>py</span> <span class=p>|</span> <span class=k>$(</span><span class=nv>BULDDIR</span><span class=k>)</span>
</span></span><span class=line><span class=cl>	python -m myguy build-report
</span></span></code></pre></div><p>By doing this, we can just issue <code>make report.xlsx</code> instead of <code>make build/report.xlsx</code>. Setting <code>build</code> to a variable (referenced via
<code>$(BUILDDIR)</code>) allows us to change up the build directory on a whim, should we
need to.</p><p>Next, we need to structure the rules that handle our queries, so let&rsquo;s add a
generic method for doing exactly that, given the path to a sql file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python3 data-lang=python3><span class=line><span class=cl><span class=c1># myguy.py, cont.</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ...other content same as before...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>BUILD_DIR</span> <span class=o>=</span> <span class=s2>&#34;build&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@cli</span><span class=o>.</span><span class=n>command</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nd>@click</span><span class=o>.</span><span class=n>argument</span><span class=p>(</span><span class=s2>&#34;path&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>query</span><span class=p>(</span><span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Issue the query located at `path` to the database, and write the results to
</span></span></span><span class=line><span class=cl><span class=s2>    a similarly-named CSV in the `build` directory.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    </span><span class=se>\b</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Examples
</span></span></span><span class=line><span class=cl><span class=s2>    --------
</span></span></span><span class=line><span class=cl><span class=s2>    This command will produce a new file foobar.csv in the `myguy.BUILD_DIR` directory:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    $ python -m myguy query sql/foobar.sql
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Hey look, more fake code for an article about querying data</span>
</span></span><span class=line><span class=cl>    <span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>destination</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>BUILD_DIR</span><span class=p>)</span> <span class=o>/</span> <span class=n>Path</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=o>.</span><span class=n>with_suffix</span><span class=p>(</span><span class=s2>&#34;.csv&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>name</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>dict</span><span class=p>(</span><span class=n>time_updated</span><span class=o>=</span><span class=p>[</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()])</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=n>to_csv</span><span class=p>(</span><span class=n>destination</span><span class=p>,</span> <span class=n>index</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Finished query for </span><span class=si>{</span><span class=n>path</span><span class=si>}</span><span class=s2> and wrote results to </span><span class=si>{</span><span class=n>destination</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>Again, imagine that the &ldquo;sleep&rdquo; we&rsquo;re doing here is some body of actual code
that fetches results from the database. We also don&rsquo;t need <code>pandas</code> for
something as banal as touching a csv with today&rsquo;s date, but it&rsquo;s there to
replicate the very common use case of <code>pd.read_sql -> to_csv</code>, which is nearly
always the most efficient way to write a program that acquires a database
connection, queries it, and writes the results to a csv for analytics-scale work
in python like this.</p><p>We&rsquo;ve also refactored out the
destination build directory into a variable, so we can have the make script grab
that automatically using the <a href=https://www.gnu.org/software/make/manual/html_node/Shell-Function.html title="GNU Make: Shell Function"><code>shell</code> built-in</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=c># Makefile
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nv>BUILDDIR</span> <span class=o>:=</span> <span class=k>$(</span>shell python -c <span class=s1>&#39;import myguy; print(myguy.BUILD_DIR)&#39;</span><span class=k>)</span>
</span></span></code></pre></div><p>This technique is also useful for having builds that depend on things like
<code>myguy.__version__</code>, if it exists. With the python in place, we need to set up
our recipes that run the queries. A naive first approach might look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=c># Makefile, cont.
</span></span></span><span class=line><span class=cl><span class=c># ... same as above ...
</span></span></span><span class=line><span class=cl><span class=c></span>
</span></span><span class=line><span class=cl><span class=nf>this_quarter_sales.csv</span><span class=o>:</span> <span class=n>this_quarter_sales</span>.<span class=n>sql</span>
</span></span><span class=line><span class=cl>	python -m myguy query sql/this_quarter_sales.sql
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>model_forecast.csv</span><span class=o>:</span> <span class=n>model_forecast</span>.<span class=n>sql</span>
</span></span><span class=line><span class=cl>	python -m myguy query sql/model_forecast.sql
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>customer_disposition.csv</span><span class=o>:</span> <span class=n>customer_disposition</span>.<span class=n>sql</span>
</span></span><span class=line><span class=cl>	python -m myguy query sql/customer_disposition.sql
</span></span></code></pre></div><p>That&rsquo;s a lot of repetition, so our programmer instincts should kick in here and
tell us that &ldquo;there must be a better way!&rdquo;<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>. Make can handle this using
<a href=https://www.gnu.org/software/make/manual/html_node/Pattern-Rules.html#Pattern-Rules title="GNU Make: Implicit Rules"><em>implicit rules</em></a>. We specify a pattern like this, and Make
will do all the hard work of connecting the files together:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=nf>%.csv</span><span class=o>:</span> %.<span class=n>sql</span> <span class=n>myguy</span>.<span class=n>py</span> <span class=p>|</span> <span class=k>$(</span><span class=nv>BUILDDIR</span><span class=k>)</span>
</span></span><span class=line><span class=cl>	@python -m myguy query $&lt;
</span></span></code></pre></div><p>This takes care of all three rules at once.</p><ul><li>The <code>%</code> is a wildcard - it matches anything and our rules here say that &ldquo;if
we&rsquo;re going to build a <code>.csv</code>, then it has a similarly-named <code>.sql</code> file as a
prerequisite.</li><li>The <code>@</code> at the start of the recipe suppresses echoing of the command when Make
runs it</li><li>The <code>$&lt;</code> is an <a href=https://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html title="GNU Make: Automatic Variables">automatic variable</a> that stands for the
first prerequisite. In our case, that will be the full path to the <code>.sql</code> file we
are passing into the query function we previously wrote.</li><li>Since <code>myguy.py</code> is the &ldquo;source&rdquo; of the running command, that&rsquo;s also a
prerequisite</li><li>the <code>| $(BUILDDIR)</code>, as before, says that we have an order-only prerequisite
on the <code>build</code> directory, and our earlier rule will ensure <code>mkdir build</code> is
run before trying to put output there</li></ul><p>Now we can issue the same command as our report to build the CSV from each of
our queries:</p><pre tabindex=0><code>$ make this_quarter_sales.csv
Finished query for sql/this_quarter_sales.sql and wrote results to build/this_quarter_sales.csv
</code></pre><p>We still need to tie all these together so that I don&rsquo;t have to run each command
manually - we want to just run <code>make report.xlsx</code> and have it do all the
prerequisite queries for us. To accomplish this, we&rsquo;re going to use two more
built-ins, <a href=https://www.gnu.org/software/make/manual/html_node/Wildcard-Function.html title="GNU Make: Wildcard Function"><code>wildcard</code></a> and <a href=https://www.gnu.org/software/make/manual/html_node/Text-Functions.html title="GNU Make: Text Functions"><code>patsubst</code></a> to build the prerequisite and
target lists, respectively.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=nv>SQLFILES</span> <span class=o>:=</span> <span class=k>$(</span>wildcard <span class=k>$(</span>SQLDIR<span class=k>)</span>/*.sql<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>TARGETS</span> <span class=o>:=</span> <span class=k>$(</span>patsubst <span class=k>$(</span>SQLDIR<span class=k>)</span>/%.sql,%.csv,<span class=k>$(</span>SQLFILES<span class=k>))</span>
</span></span></code></pre></div><p>If we were to echo the contents of these two variables, they would look like
this:</p><pre tabindex=0><code># contents of SQLFILES
sql/customer_disposition.sql sql/model_forecast.sql sql/this_quarter_sales.sql

# contents of TARGETS
customer_disposition.csv model_forecast.csv this_quarter_sales.csv
</code></pre><p>Since our <code>report.xlsx</code> depends on all three of the files in <code>TARGETS</code>, we bind
them together in that rule:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=c># Makefile
</span></span></span><span class=line><span class=cl><span class=c></span>
</span></span><span class=line><span class=cl><span class=c># ... other content same as before ...
</span></span></span><span class=line><span class=cl><span class=c></span>
</span></span><span class=line><span class=cl><span class=nf>report.xlsx</span><span class=o>:</span> <span class=k>$(</span><span class=nv>TARGETS</span><span class=k>)</span>
</span></span><span class=line><span class=cl>	@python -m myguy build-report
</span></span></code></pre></div><p>Note here that we took out the <code>myguy.py</code> and <code>$(BUILDDIR)</code> prerequisites from
this rule, since those are coming from our implicit rule on the <code>$(TARGETS)</code>.
I&rsquo;m also going to add a <code>clean</code> rule for trying things over from a fresh start:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=nf>clean</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	@<span class=o>[</span> ! -d <span class=k>$(</span>BUILDDIR<span class=k>)</span> <span class=o>]</span> <span class=o>||</span> rm -r <span class=k>$(</span>BUILDDIR<span class=k>)</span>
</span></span></code></pre></div><p>Decomposing this into English:</p><ul><li><code>@</code> - don&rsquo;t echo this command when it runs. Just run it.</li><li><code>[ ! -d $(BUILDDIR) ] ||</code> - unless the BUILDDIR is missing, do the next
command<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></li><li><code>rm -r $(BUILDDIR)</code> - remove the contents of the BUILDDIR recursively</li></ul><p>Here&rsquo;s where our <code>Makefile</code> is now:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=c># Makefile
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nv>BUILDDIR</span> <span class=o>:=</span> <span class=k>$(</span>shell python -c <span class=s1>&#39;import myguy; print(myguy.BUILD_DIR)&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>SQLDIR</span> <span class=o>:=</span> sql
</span></span><span class=line><span class=cl><span class=nv>VPATH</span> <span class=o>:=</span> <span class=k>$(</span>SQLDIR<span class=k>)</span>:<span class=k>$(</span>TARGETDIR<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>SQLFILES</span> <span class=o>:=</span> <span class=k>$(</span>wildcard <span class=k>$(</span>SQLDIR<span class=k>)</span>/*.sql<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>TARGETS</span> <span class=o>:=</span> <span class=k>$(</span>patsubst <span class=k>$(</span>SQLDIR<span class=k>)</span>/%.sql,%.csv,<span class=k>$(</span>SQLFILES<span class=k>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>report.xlsx</span><span class=o>:</span> <span class=k>$(</span><span class=nv>TARGETS</span><span class=k>)</span>
</span></span><span class=line><span class=cl>	@python -m myguy build-report
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>$(BUILDDIR)</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	mkdir -p <span class=k>$(</span>BUILDDIR<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>%.csv</span><span class=o>:</span> %.<span class=n>sql</span> <span class=n>myguy</span>.<span class=n>py</span> <span class=p>|</span> <span class=k>$(</span><span class=nv>BUILDDIR</span><span class=k>)</span>
</span></span><span class=line><span class=cl>	@python -m myguy query $&lt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>clean</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	@<span class=o>[</span> ! -d <span class=k>$(</span>BUILDDIR<span class=k>)</span> <span class=o>]</span> <span class=o>||</span> rm -r <span class=k>$(</span>BUILDDIR<span class=k>)</span>
</span></span></code></pre></div><p>So now we can run <code>clean</code> and build the report:</p><script id=asciicast-k6BCaD1qgCjvmq157MUkOrd4d src=https://asciinema.org/a/k6BCaD1qgCjvmq157MUkOrd4d.js async></script><p>We can do better though. Make has parallelism built in, and most of our
computers have no trouble running things concurrently. By providing
the <code>-j</code> (jobs) flag, we can tell it to do several things at once as long as
they don&rsquo;t depend on one another. Since our intermediate queries to CSV fit the
bill, they can all run at the same time:</p><script id=asciicast-GznCov5dP98vCmtK223Xvoo6G src=https://asciinema.org/a/GznCov5dP98vCmtK223Xvoo6G.js async></script><p>It&rsquo;s also possible to enable parallelism by default with the <code>MAKEFLAGS</code> special
variable.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=c># Makefile
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nv>MAKEFLAGS</span> <span class=o>:=</span> --jobs<span class=o>=</span><span class=k>$(</span>shell nproc<span class=k>)</span>
</span></span></code></pre></div><h1 id=adding-dependencies-between-intermediate-queries class="relative group">Adding dependencies between intermediate queries <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#adding-dependencies-between-intermediate-queries aria-label=Anchor>#</a></span></h1><p>Let&rsquo;s suppose we add two more queries, and they need to run before our existing
queries, because we did a little refactoring of our SQL.</p><p><figure><img class="my-0 rounded-md" srcset="/posts/poor_mans_dbt/our-dag_hu2f86a2322769275a9b1a887ead08ed56_171913_330x0_resize_box_3.png 330w,
/posts/poor_mans_dbt/our-dag_hu2f86a2322769275a9b1a887ead08ed56_171913_660x0_resize_box_3.png 660w,
/posts/poor_mans_dbt/our-dag_hu2f86a2322769275a9b1a887ead08ed56_171913_1024x0_resize_box_3.png 1024w,
/posts/poor_mans_dbt/our-dag_hu2f86a2322769275a9b1a887ead08ed56_171913_1320x0_resize_box_3.png 2x" src=/posts/poor_mans_dbt/our-dag_hu2f86a2322769275a9b1a887ead08ed56_171913_660x0_resize_box_3.png alt="Our DAG"><figcaption>Our DAG</figcaption></figure></p><p>Moreover, let&rsquo;s assume that these two new tables are too large to cache locally
in a flat file, and we have to issue a CREATE TABLE AS (ctas) statement to build
them first. Not every database will permit you to run a CTAS on it, but imagine
this is any process that writes data remotely instead of locally, such as spark
writing a parquet file on S3, or submitting a POST request to an endpoint we
don&rsquo;t control.</p><p>We represent this in Make by first writing out the targets and prerequisites
with different suffixes. For the remote tables, I&rsquo;ll use the &lsquo;.ctas&rsquo; suffix. I
also like to do this in a separate file, <code>dag.mk</code>, so I can hop to its buffer
directly in my editor.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=c># dag.mk
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nf>sales_subset.ctas</span><span class=o>:</span>
</span></span><span class=line><span class=cl><span class=nf>customer_product.ctas</span><span class=o>:</span>
</span></span><span class=line><span class=cl><span class=nf>this_quarter_sales.csv model_forecast.csv</span><span class=o>:</span> <span class=n>sales_subset</span>.<span class=n>ctas</span>
</span></span><span class=line><span class=cl><span class=nf>customer_disposition.csv</span><span class=o>:</span> <span class=n>customer_product</span>.<span class=n>ctas</span>
</span></span></code></pre></div><p>This arrangement forces the completion of <code>sales_subset.csv</code> and
<code>customer_product.csv</code> prior to the original three queries. Then in the main
<code>MakeFile</code>, we include these contents above the rules that handle <code>.csv</code> files,
along with a new rule for handling the remote tables. The <code>%.ctas</code> rule will
create an <em>empty target</em> as soon as the query is done, signaling to make when it
last completed successfully:</p><pre tabindex=0><code># Makefile
# ... other content the same ...
include dag.mk

%.csv: %.sql myguy.py | $(BUILDDIR)
	@python -m myguy query $&lt;

%.ctas: %.sql myguy.py | $(BUILDDIR)
	@python -m myguy ctas $&lt;
	@touch $(BUILDDIR)/$@
</code></pre><p>Note that this includes a new command for <code>myguy</code>, so let&rsquo;s add that too:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python3 data-lang=python3><span class=line><span class=cl><span class=c1># myguy.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@cli</span><span class=o>.</span><span class=n>command</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nd>@click</span><span class=o>.</span><span class=n>argument</span><span class=p>(</span><span class=s2>&#34;path&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ctas</span><span class=p>(</span><span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Perform a CREATE TABLE AS statement from the SELECT statement in the given
</span></span></span><span class=line><span class=cl><span class=s2>    SQL file path.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>sql_file</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>query</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;CREATE TABLE </span><span class=si>{</span><span class=n>sql_file</span><span class=o>.</span><span class=n>stem</span><span class=si>}</span><span class=s2> AS </span><span class=si>{</span><span class=n>sql_file</span><span class=o>.</span><span class=n>read_text</span><span class=p>()</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>query</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sleep</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>  <span class=c1># imagine the query is running</span>
</span></span></code></pre></div><p>*** TODO could also do it via adding another directory under target for the csv queries***</p><p>And one last thing - our <code>$(TARGETS)</code> assignment has no way of
telling which sql files it should or shouldn&rsquo;t tie to CSVs. The easiest way to
make this distinction is to actually just remove $(TARGETS) altogether, and have
the <code>dag.mk</code> declare what <code>report.xlsx</code> depends on.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=c># dag.mk
</span></span></span><span class=line><span class=cl><span class=c># ...other contents the same...
</span></span></span><span class=line><span class=cl><span class=c></span><span class=nf>report.xlsx</span><span class=o>:</span> <span class=n>this_quarter_sales</span>.<span class=n>csv</span> \
</span></span><span class=line><span class=cl>	<span class=n>model_forecast</span>.<span class=n>csv</span> \
</span></span><span class=line><span class=cl>	<span class=n>customer_disposition</span>.<span class=n>csv</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-make data-lang=make><span class=line><span class=cl><span class=c># Makefile
</span></span></span><span class=line><span class=cl><span class=c></span>
</span></span><span class=line><span class=cl><span class=nf>report.xlsx</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	@python -m myguy build-report
</span></span></code></pre></div><p>Make will take care of combining these two rules into a single one. If all the
targets are going to have the same suffix, such as <code>.ctas</code> or <code>.csv</code>, then the
trick with <code>$(TARGETS)</code> is handy, but adds more complexity than it&rsquo;s worth when
mixing target file types.</p><p>Altogether, our dag now looks like this:</p><script id=asciicast-kYzgUqw3qGKKKa9KbsUaz7hur src=https://asciinema.org/a/kYzgUqw3qGKKKa9KbsUaz7hur.js async></script><br><br><h1 id=templating-the-sql-with-jinja class="relative group">Templating the SQL with Jinja <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#templating-the-sql-with-jinja aria-label=Anchor>#</a></span></h1><p>To round out some of our feature parity with dbt, we need to add templating
to our SQL. It&rsquo;s best if I don&rsquo;t have to think about <em>how</em> the template is
injected, I just want a standard place to put stuff and have the python module
take care of it. Let&rsquo;s introduce a configuration file:</p><pre tabindex=0><code># config.yml
sales_max_date: &#34;2022-03-01&#34;
sales_min_date: &#34;2021-09-01&#34;
</code></pre><p>Presumably, a future analyst will have to come refresh this report for a
different set of dates, and we want that configuration readily available to
them. The templating engine we&rsquo;ll use is the same on available on dbt,
Jinja2. How we integrate it is by intercepting our python code that reads
queries and applying the template from the config there. The jinja2 part is a
little verbose, but flexible - anything that&rsquo;s in our config will be available
to the templated SQL:<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python3 data-lang=python3><span class=line><span class=cl><span class=c1># myguy.py</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>yaml</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>jinja2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ... other content the same ...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>BUILD_DIR</span> <span class=o>=</span> <span class=s2>&#34;build&#34;</span>
</span></span><span class=line><span class=cl><span class=n>PROJECT_DIR</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=vm>__file__</span><span class=p>)</span><span class=o>.</span><span class=n>parent</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_config</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>PROJECT_DIR</span> <span class=o>/</span> <span class=s2>&#34;config.yml&#34;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>config</span> <span class=o>=</span> <span class=n>yaml</span><span class=o>.</span><span class=n>safe_load</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>config</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># The `str | Path` union type hint is python 3.10 syntax, so watch out if you&#39;re</span>
</span></span><span class=line><span class=cl><span class=c1># on an older version!</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>read_sql_text</span><span class=p>(</span><span class=n>path</span><span class=p>:</span> <span class=nb>str</span> <span class=o>|</span> <span class=n>Path</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Read a SQL file contents and apply jinja templating from this project&#39;s
</span></span></span><span class=line><span class=cl><span class=s2>    config.yml
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>config</span> <span class=o>=</span> <span class=n>get_config</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>jinja_loader</span> <span class=o>=</span> <span class=n>jinja2</span><span class=o>.</span><span class=n>FileSystemLoader</span><span class=p>(</span><span class=n>PROJECT_DIR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>jinja_environment</span> <span class=o>=</span> <span class=n>jinja2</span><span class=o>.</span><span class=n>Environment</span><span class=p>(</span><span class=n>loader</span><span class=o>=</span><span class=n>jinja_loader</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>template</span> <span class=o>=</span> <span class=n>jinja_environment</span><span class=o>.</span><span class=n>get_template</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>path</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sql</span> <span class=o>=</span> <span class=n>template</span><span class=o>.</span><span class=n>render</span><span class=p>(</span><span class=o>**</span><span class=n>config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>sql</span>
</span></span></code></pre></div><p>And now we use this version of the sql in the <code>ctas</code> and <code>query</code> functions:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python3 data-lang=python3><span class=line><span class=cl><span class=c1># myguy.py</span>
</span></span><span class=line><span class=cl><span class=c1># ...other content the same ...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>query</span><span class=p>(</span><span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>sql</span> <span class=o>=</span> <span class=n>read_sql_text</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>destination</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>BUILD_DIR</span><span class=p>)</span> <span class=o>/</span> <span class=n>Path</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=o>.</span><span class=n>with_suffix</span><span class=p>(</span><span class=s2>&#34;.csv&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>name</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Assuming you have some way of acquiring a database connection</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>get_connection</span><span class=p>()</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>pd</span><span class=o>.</span><span class=n>read_sql</span><span class=p>(</span><span class=n>sql</span><span class=p>,</span> <span class=n>conn</span><span class=p>)</span><span class=o>.</span><span class=n>to_csv</span><span class=p>(</span><span class=n>destination</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ctas</span><span class=p>(</span><span class=n>path</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sql</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;CREATE TABLE `</span><span class=si>{</span><span class=n>path</span><span class=o>.</span><span class=n>stem</span><span class=si>}</span><span class=s2>` AS </span><span class=si>{</span><span class=n>read_sql_text</span><span class=p>(</span><span class=n>path</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>get_connection</span><span class=p>()</span> <span class=k>as</span> <span class=n>conn</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=n>sql</span><span class=p>)</span>
</span></span></code></pre></div><p>Within the SQL itself, we can now reference any of the keys in the <code>config.yml</code>
directly:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=n>sales_subset</span><span class=p>.</span><span class=k>sql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>product_id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>,</span><span class=w> </span><span class=n>sales_revenue</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>,</span><span class=w> </span><span class=n>sales_units</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>fact_sales</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sales_date</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=nb>date</span><span class=p>(</span><span class=s1>&#39;{{ sales_min_date }}&#39;</span><span class=p>)</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=nb>date</span><span class=p>(</span><span class=s1>&#39;{{ sales_max_date }}&#39;</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>I&rsquo;m not here to cover everything you can do with jinja and yaml, since those are
already pretty well covered. If you haven&rsquo;t used it before, it&rsquo;s worth looking
into. It&rsquo;s very powerful. The looping and conditional constructs can make what
would normally be pretty tough with just raw SQL easy. When we issue a <code>make recent_sales.ctas</code> command, it looks like this:</p><pre tabindex=0><code>$ make sales_subset.ctas
mkdir -p build
CREATE TABLE `sales_subset` AS SELECT
    product_id
  , sales_revenue
  , sales_units
FROM
    fact_sales
WHERE
    sales_date BETWEEN date(&#39;2021-09-01&#39;) AND date(&#39;2022-03-01&#39;)
</code></pre><br><br><h1 id=conclusion class="relative group">Conclusion <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#conclusion aria-label=Anchor>#</a></span></h1><p>There we have it, a simple little dag system for coordinating our project&rsquo;s
deliverables. Next week I will add a finished version of the code from this
article mocked up using SQLite as the data source on the
<a href=https://github.com/lerocha/chinook-database title="Chinook on github">chinook</a> dataset. These examples will also include
to add a few more output, such as code that produces <code>.png</code> files for
including into presentations and migrating the <code>mypy.py</code> into a fully-fledged,
pip-installable module.</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>Except Windows. You&rsquo;ll need to get it via mingw/cygwin or via the Windows
subsystem for Linux.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>I fully acknowledge the irony here that <code>make</code> is, in fact, a very foreign
tool to many data scientists.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p>These are called <a href=https://www.gnu.org/software/make/manual/html_node/Prerequisite-Types title="GNU Make: Prerequisite Types">order-only prerequisites</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p>I&rsquo;m taking this phrase from Raymond Hettinger, who gives fantastic talks
on writing idomatic python. I recommend his <a href="https://www.youtube.com/watch?v=wf-BqAjZb8M" title="Raymond Hettinger: Beyond PEP8">beyond PEP8</a> talk
to all levels of developers.&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5 role=doc-endnote><p>We do &ldquo;unless&rdquo; instead of the more familiar &ldquo;if&rdquo; statement, because
if we did this: <code>[ -d $(BUILDDIR) ] && rm -r $(BUILDDIR)</code> the test command <code>[</code>
exits with status 1 when the build directory doesn&rsquo;t exist, and hence the
whole pipe exits status 1. Make treats that as a failed recipe, which isn&rsquo;t
what we intend. We want it to look like a success both in the
case of removing the directory should it exist, and doing nothing if it
doesn&rsquo;t.&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6 role=doc-endnote><p>You should be extremely careful about templating like this. This article
also uses f-strings for injecting arbitrary code into SQL, which is
unacceptable if any of your system is public facing. All of these examples
are working under the assumption that we&rsquo;re in a locked-down internal data
warehouse, and someone who has access to the system in <em>any</em> way is allowed to
issue an arbitrary query.&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></section><footer class="pt-8 max-w-prose"><div class=flex><img class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full" width=96 height=96 alt=Author src=/img/piano_keys_hu2feb3ffad86602f2249b56a710ae2146_3764478_192x192_fill_q75_box_smart1.jpg><div class=place-self-center><div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Robert Enzmann</div><div class="text-sm text-neutral-700 dark:text-neutral-400">I create tools in python that empower data science teams of all levels.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:robbenzmann@gmail.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="at" class="svg-inline--fa fa-at fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 8C118.941 8 8 118.919 8 256c0 137.059 110.919 248 248 248 48.154.0 95.342-14.14 135.408-40.223 12.005-7.815 14.625-24.288 5.552-35.372l-10.177-12.433c-7.671-9.371-21.179-11.667-31.373-5.129C325.92 429.757 291.314 440 256 440c-101.458.0-184-82.542-184-184S154.542 72 256 72c100.139.0 184 57.619 184 160 0 38.786-21.093 79.742-58.17 83.693-17.349-.454-16.91-12.857-13.476-30.024l23.433-121.11C394.653 149.75 383.308 136 368.225 136h-44.981a13.518 13.518.0 00-13.432 11.993l-.01.092c-14.697-17.901-40.448-21.775-59.971-21.775-74.58.0-137.831 62.234-137.831 151.46.0 65.303 36.785 105.87 96 105.87 26.984.0 57.369-15.637 74.991-38.333 9.522 34.104 40.613 34.103 70.71 34.103C462.609 379.41 504 307.798 504 232 504 95.653 394.023 8 256 8zm-21.68 304.43c-22.249.0-36.07-15.623-36.07-40.771.0-44.993 30.779-72.729 58.63-72.729 22.292.0 35.601 15.241 35.601 40.77.0 45.061-33.875 72.73-58.161 72.73z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/renzmann target=_blank aria-label=Github rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/renzmann target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group" href=/posts/my-first-post/><span class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Objective</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-02-26 21:05:32 -0500 -0500">26 February 2022</time></span></span></a></span>
<span></span></div></div></footer></article><div class="absolute top-[110vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-[-5.5rem]"><a href=#the-top class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><div id=search-wrapper class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible" data-url=https://robbmann.io><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative inline-block align-text-bottom icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" class="svg-inline--fa fa-times fa-w-11" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path fill="currentcolor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19.0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48.0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48.0L9.21 111.45c-12.28 12.28-12.28 32.19.0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19.0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48.0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48.0l22.24-22.24c12.28-12.28 12.28-32.19.0-44.48L242.72 256z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div><footer class=py-10><div class="flex justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Robert Enzmann</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a></p></div></div></footer></body></html>